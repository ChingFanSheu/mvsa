---
title:  |  
  | *Multivariate Analysis for the Behavioral Sciences,*
  | **Examples of Chapter 13:**
  | **Principal Components Analysis**
author: |
  | Kimmo Vehkalahti, Brian S. Everitt; edited by C.-F. Sheu
  |
date: '`r format(Sys.time(), "%d %B, %Y")`'
output: 
  rmarkdown::github_document:
  pdf_document:
    number_sections: no
    toc: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  message = FALSE,
  fig.align = 'center',
  comment = "",
  tidy = FALSE,     # display code as typed
  size = "small")   # slightly smaller font for code)
```


```{r message=FALSE, warning=FALSE}
# check to see if the pacman package is there
# if not install it and then use it manage packages
if (!require(pacman)) install.packages("pacman")
pacman::p_load(tidyverse, calibrate, factoextra)
```

\pagebreak

## Example: Head size

In the data set, variables X1 and X2 are the head length (in millimeters) and head breadth of the first son and Y1 and Y2 are the same variables for the second son of 25 families

Frets, G.P. (1921). 
Heredity of head form in man, *Genetica 3*, pp. 193-384.

\pagebreak

## Table 13.4: Head Lengths of First and Second Sons 

```{r}
data(heads, package = "calibrate")
head_dat <- heads[,c(1,3)]
glimpse(head_dat)
```

```{r}
apply(head_dat, 2, mean)
```

```{r}
# covariance matrix of the heads data set
cov(head_dat)
```


```{r}
# get principal components
head_pc <- princomp(covmat = var(head_dat))
head_pc
print(summary(head_pc), digits = 3, loadings = TRUE)
```

```{r}
head_pc1 <- princomp(head_dat, scores = TRUE)
head_pc1
```

```{r}
# pc scores for first family
head_pc1$scores[1, ]
# first component score for first family
head_pc1$loadings[1,] %*% t(head_dat[1,] - c(mean(head_dat[,1]), mean(head_dat[,2])))
# second component score for first family
head_pc1$loadings[2,] %*% t(head_dat[1,] - c(mean(head_dat[,1]), mean(head_dat[,2])))
```

```{r}
# reproduce covariance matrix from sdev and loadings
X <- cbind(head_pc$sdev[1] * head_pc$loadings[1,],
           head_pc$sdev[2] * head_pc$loadings[2,])
X %*% t(X)
tcrossprod(X)
# t(X) %*% X
crossprod(X)
```

\pagebreak

## Figure 13.2

```{r fig13.2, fig.width=7, fig.height=7}
# rotation of axes
plot(heads[, c(1,3)], 
     xlab = "First Son's Head Length (mm)", 
     ylab = "Second Son's Head Length")
a1 <- mean(head_dat[,2])-(head_pc$loadings[1,2]*mean(head_dat[,1])/head_pc$loadings[1,1])
b1 <- head_pc$loadings[1,2]/head_pc$loadings[1,1]
a2 <- mean(head_dat[,2])-(head_pc$loadings[2,2]*mean(head_dat[,1])/head_pc$loadings[2,1])
b2 <- head_pc$loadings[2,2]/head_pc$loadings[2,1]
abline(a1, b1)
abline(a2, b2, lty = 2)
```

\pagebreak

## Figure 13.3

```{r fig13.3, fig.width=7, fig.height=7}
xlim <- range(head_pc1$scores[, 1])
plot(head_pc1$scores, xlim = xlim, ylim = xlim)
grid()
```

```{r fig13.3b, fig.width=7, fig.height=7}
fviz_pca(head_pc1) +
  ggtitle("PCA-plot from head size data") +
  theme(plot.title = element_text(hjust = 0.5))
```


\pagebreak

## Session information

```{r session_info, include=FALSE}
# set include=TRUE to view the results
sessionInfo()
```

